<!DOCTYPE html>
<html lang="so">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Laam wallet - Full Updated</title>
    <!-- Favicon & OG Image -->
    <link rel="icon" type="image/png" href="https://i.ibb.co/r28SP1bN/20250802-225108.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co/r28SP1bN/20250802-225108.png">
    <meta property="og:image" content="https://i.ibb.co/r28SP1bN/20250802-225108.png">
    <meta property="og:title" content="Laam wallet - Modern Digital Currency">
    <meta property="og:description" content="Laam Token is a digital asset built on Stellar with a fixed supply.">
    <meta property="og:url" content="https://laam.online">
    <meta property="og:type" content="website">
<!-- Android PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1976d2">

<!-- iPhone / iPad PWA -->
<link rel="apple-touch-icon" href="https://i.ibb.co/r28SP1bN/20250802-225108.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Laam Wallet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/10.4.0/stellar-sdk.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<!-- Add Chart.js for beautiful charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  .custom-alert {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #28a745;
    color: white;
    padding: 14px 22px;
    border-radius: 12px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    z-index: 9999;
    display: none;
    animation: fadeInUp 0.4s ease;
  }
  @keyframes fadeInUp {
    from { opacity: 0; transform: translate(-50%, 20px); }
    to { opacity: 1; transform: translate(-50%, 0); }
  }
</style>
    
    <style>
  :root{
    /* Blue & White Theme */
    --bg1:#eef2f3; --bg2:#8e9eab;
    --card:rgba(255, 255, 255, 0.9);
    --text:#0a192f; --muted:#546e7a;
    --brand:#0052cc; --brand2:#0041a3; --line:#d0d8e0;
    --ok:#28a745; --warn:#ffc107; --err:#dc3545;
    --maxw: 920px; --rad:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    color:var(--text);
    background:linear-gradient(135deg,#b8c6db,#f5f7fa);
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px 14px;
  }
  .app{ width:100%; max-width:450px; text-align:center; }
  
  /* Logo and Header Styles */
  .logo-container{ 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    gap:15px; 
    margin-bottom:40px; 
  }
  .logo-container img{ 
    width:80px; 
    height:80px; 
    border-radius:50%;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  h1{ 
    margin:0; 
    font-size:3rem; 
    font-weight:800; 
    color:#1976d2; 
    text-shadow:1px 1px 2px rgba(0,0,0,0.1); 
  }
  
  /* Import Card Styles */
  .import-card{
    background:rgba(255, 255, 255, 0.95);
    border:none;
    border-radius:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.12);
    padding:40px 30px;
    margin:0 auto;
    backdrop-filter:blur(10px);
    max-width:100%;
  }
  
  .form-group{
    margin-bottom:24px;
    text-align:left;
  }
  
  .form-label{
    display:block;
    font-size:18px;
    font-weight:700;
    color:#1976d2;
    margin-bottom:12px;
  }
  
  .form-input{
    width:100%;
    padding:20px;
    border:2px solid #e0e0e0;
    border-radius:16px;
    font-size:16px;
    background:#f8f9fa;
    color:#333;
    outline:none;
    transition:all 0.3s ease;
    font-family:'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
  }
  
  .form-input:focus{
    border-color:#1976d2;
    background:white;
    box-shadow:0 0 0 4px rgba(25,118,210,0.1);
  }
  
  .form-input::placeholder{
    color:#bbb;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  }
  
  .import-button{
    width:100%;
    padding:20px;
    background:#1976d2;
    color:white;
    border:none;
    border-radius:16px;
    font-size:18px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:1px;
    cursor:pointer;
    transition:all 0.3s ease;
    box-shadow:0 4px 16px rgba(25,118,210,0.3);
    margin-top:16px;
  }
  
  .import-button:hover{
    background:#1565c0;
    box-shadow:0 6px 20px rgba(25,118,210,0.4);
    transform:translateY(-2px);
  }
  
  .divider{
    margin:32px 0;
    text-align:center;
    position:relative;
  }
  
  .divider::before{
    content:'';
    position:absolute;
    top:50%;
    left:0;
    right:0;
    height:1px;
    background:#e0e0e0;
  }
  
  .divider-text{
    background:rgba(255, 255, 255, 0.95);
    padding:0 16px;
    color:#666;
    font-size:14px;
    font-weight:500;
  }
  
  .generate-link{
    text-align:center;
  }
  
  .generate-button{
    color:#1976d2;
    text-decoration:underline;
    background:none;
    border:none;
    cursor:pointer;
    font-size:16px;
    font-weight:600;
    transition:color 0.3s ease;
    text-transform:none;
    padding:0;
    width:auto;
    box-shadow:none;
  }
  
  .generate-button:hover{
    color:#1565c0;
    transform:none;
    box-shadow:none;
  }
  .note-text{
    font-size:12px;
    color:#666;
    margin-top:8px;
    line-height:1.4;
  }

  /* Key Display Modal */
  .key-modal{
    display:none;
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:1000;
    align-items:center;
    justify-content:center;
  }
  .key-modal.show{
    display:flex;
  }
  .key-modal-content{
    background:rgba(255, 255, 255, 0.95);
    border:none;
    border-radius:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.12);
    padding:40px 30px;
    max-width:500px;
    width:90%;
    max-height:90vh;
    overflow-y:auto;
    backdrop-filter:blur(10px);
  }
  .key-modal-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:30px;
  }
  .key-modal-title{
    font-size:1.8rem;
    font-weight:700;
    color:#1976d2;
    margin:0;
  }
  .key-modal-close{
    background:none;
    border:none;
    font-size:2rem;
    cursor:pointer;
    color:#666;
    padding:0;
    width:auto;
    height:auto;
    box-shadow:none;
    text-transform:none;
  }
  .key-modal-close:hover{
    color:#333;
    transform:none;
    box-shadow:none;
  }
  .key-display-group{
    margin-bottom:30px;
  }
  .key-display-label{
    display:block;
    font-size:16px;
    font-weight:700;
    color:#1976d2;
    margin-bottom:12px;
  }
  .key-display-container{
    position:relative;
    display:flex;
    align-items:center;
  }
  .key-display-input{
    width:100%;
    padding:15px 60px 15px 15px;
    border:2px solid #e0e0e0;
    border-radius:12px;
    font-size:14px;
    background:#f8f9fa;
    color:#333;
    font-family:'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    word-break:break-all;
    resize:none;
  }
  .copy-btn{
    position:absolute;
    right:10px;
    background:#1976d2;
    color:white;
    border:none;
    border-radius:8px;
    padding:8px 12px;
    font-size:12px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
    text-transform:uppercase;
    box-shadow:0 2px 8px rgba(25,118,210,0.3);
  }
  .copy-btn:hover{
    background:#1565c0;
    box-shadow:0 4px 12px rgba(25,118,210,0.4);
    transform:translateY(-1px);
  }
  .copy-btn.copied{
    background:#28a745;
    box-shadow:0 2px 8px rgba(40,167,69,0.3);
  }
  .warning-text{
    background:#fff3cd;
    border:1px solid #ffeaa7;
    border-radius:12px;
    padding:15px;
    margin:20px 0;
    color:#856404;
    font-size:14px;
    line-height:1.5;
  }
  .use-account-btn{
    width:100%;
    padding:15px;
    background:#28a745;
    color:white;
    border:none;
    border-radius:12px;
    font-size:16px;
    font-weight:700;
    text-transform:uppercase;
    cursor:pointer;
    transition:all 0.3s ease;
    box-shadow:0 4px 16px rgba(40,167,69,0.3);
  }
  .use-account-btn:hover{
    background:#218838;
    box-shadow:0 6px 20px rgba(40,167,69,0.4);
    transform:translateY(-2px);
  }

  /* Main Card Styles */
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:var(--rad);
    box-shadow:0 10px 30px rgba(0,0,0,0.1); padding:22px; margin:14px auto;
  }
  .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media (max-width:820px){ .grid-2{ grid-template-columns:1fr; } }
  label{ display:block; text-align:left; margin:8px 0 6px; font-weight:600; color:var(--brand); }
  input,select,button{
    width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:12px; font-size:1rem;
    background:#f8f9fa; color:var(--text); outline:none; transition:border-color .2s ease;
  }
  input:focus{ border-color:var(--brand); }
  button{
    background:var(--brand); color:#fff; font-weight:700; letter-spacing:.02em; border:none;
    box-shadow:0 4px 14px rgba(0,82,204,0.3); cursor:pointer; text-transform:uppercase; transition:all .2s ease;
  }
  button:hover{ background:var(--brand2); box-shadow:0 6px 18px rgba(0,65,163,0.4); transform:translateY(-2px); }
  button:disabled{ background:#b0bec5; cursor:not-allowed; box-shadow:none; transform:none; }
  .btn-secondary{ background:#6c757d; color:#fff; box-shadow:0 4px 14px rgba(0,0,0,0.1); }
  .btn-secondary:hover{ background:#5a6268; }
  .btn-danger{ background:var(--err); color:#fff; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .btn-danger:hover{ background:#c82333; }
  .mono{
    font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
    background:#e9ecef; padding:10px 12px; border-radius:12px; overflow-wrap:anywhere; color:#343a40;
  }
  .muted{ color:var(--muted); font-size:.92rem; }
  .balances{ display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .pill{ background:#e9ecef; border:1px solid var(--line); padding:8px 14px; border-radius:999px; font-weight:600; }
  .hidden{ display:none; }
  .send-wrap{ display:none; margin-top:16px; text-align:left; border-top:1px solid var(--line); padding-top:16px; }
  .send-row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  @media (max-width:640px){ .send-row{ grid-template-columns:1fr; } }

  /* Trade Section Styles */
  .trade-card{ padding:0; overflow:hidden; }
  .trade-header{ display:flex; justify-content:space-between; align-items:center; padding:16px 20px; border-bottom:1px solid var(--line); }
  .trade-header h3{ margin:0; font-size:1.2rem; }
  .trade-header .icon{ font-size:1.5rem; cursor:pointer; transition:color 0.3s ease; }
  .trade-header .icon:hover{ color:var(--brand); }
  .trade-asset-selector{ display:flex; align-items:center; justify-content:space-between; padding:16px 20px; background:#f8f9fa; }
  .asset-box{ display:flex; align-items:center; gap:8px; }
  .asset-box img{ width:24px; height:24px; border-radius:50%; }
  .asset-box .asset-name{ font-weight:600; }
  .asset-box .asset-issuer{ font-size:.8rem; color:var(--muted); }
  .swap-icon{ font-size:1.5rem; background:#fff; border-radius:50%; padding:5px; border:1px solid var(--line); cursor:pointer; transition:all 0.3s ease; }
  .swap-icon:hover{ background:var(--brand); color:#fff; transform:rotate(180deg); }
  .trade-tabs{ display:flex; border-bottom:1px solid var(--line); background:#f8f9fa; }
  .trade-tabs .tab{ 
    flex:1; padding:12px; text-align:center; cursor:pointer; font-weight:600; 
    color:var(--muted); border-bottom:3px solid transparent; 
    transition:all 0.3s ease; position:relative;
  }
  .trade-tabs .tab:hover{ background:rgba(0,82,204,0.1); color:var(--brand); }
  .trade-tabs .tab.active{ color:var(--brand); border-bottom-color:var(--brand); background:#fff; }
  .tab-content{ display:none; }
  .tab-content.active{ display:block; }
  .overview-content{ padding:20px; text-align:center; }
  .price-display{ font-size:2.5rem; font-weight:bold; margin-bottom:10px; color:var(--brand); }
  .price-change{ font-size:1rem; margin-bottom:20px; }
  .price-change.positive{ color:var(--ok); }
  .price-change.negative{ color:var(--err); }
  .chart-timeframes{ display:flex; justify-content:center; gap:10px; margin-bottom:20px; }
  .timeframe-btn{ 
    padding:8px 15px; border-radius:8px; border:1px solid var(--line); 
    background:#f8f9fa; color:var(--text); cursor:pointer; transition:all 0.3s ease;
    font-size:0.9rem; font-weight:600;
  }
  .timeframe-btn:hover, .timeframe-btn.active{ background:var(--brand); color:#fff; border-color:var(--brand); }
  .chart-container {
    width:100%; 
    height:200px; 
    margin-bottom:20px;
    position: relative;
  }
  .market-stats{ display:grid; grid-template-columns:1fr 1fr; gap:15px; text-align:left; }
  .stat-item{ background:#f8f9fa; padding:12px; border-radius:8px; border:1px solid var(--line); }
  .stat-label{ font-size:0.8rem; color:var(--muted); margin-bottom:4px; }
  .stat-value{ font-weight:600; color:var(--text); }
  .orderbook-content{ padding:10px 20px 20px; }
  .orderbook-table{ width:100%; border-collapse:collapse; margin-bottom:10px; }
  .orderbook-table th,.orderbook-table td{ text-align:right; padding:8px 4px; font-size:.9rem; }
  .orderbook-table th{ color:var(--muted); font-weight:600; border-bottom:2px solid var(--line); }
  .orderbook-table th:first-child,.orderbook-table td:first-child{ text-align:left; }
  .orderbook-table .bid-row{ cursor:pointer; transition:background 0.2s ease; }
  .orderbook-table .bid-row:hover{ background:rgba(40,167,69,0.1); }
  .orderbook-table .bid-row td:nth-child(2){ color:var(--ok); font-weight:600; }
  .orderbook-table .ask-row{ cursor:pointer; transition:background 0.2s ease; }
  .orderbook-table .ask-row:hover{ background:rgba(220,53,69,0.1); }
  .orderbook-table .ask-row td:nth-child(2){ color:var(--err); font-weight:600; }
  .spread{ 
    padding:12px 0; text-align:center; font-weight:bold; 
    border-top:1px solid var(--line); border-bottom:1px solid var(--line); 
    margin:8px 0; background:#f8f9fa; border-radius:8px;
  }
  .trades-content{ padding:10px 20px 20px; }
  .trades-table{ width:100%; border-collapse:collapse; }
  .trades-table th,.trades-table td{ text-align:right; padding:8px 4px; font-size:.9rem; }
  .trades-table th{ color:var(--muted); font-weight:600; border-bottom:2px solid var(--line); }
  .trades-table th:first-child,.trades-table td:first-child{ text-align:left; }
  .trade-buy{ color:var(--ok); }
  .trade-sell{ color:var(--err); }
  .trade-time{ color:var(--muted); font-size:0.8rem; }
  .trade-actions{ display:flex; gap:15px; padding:20px; background:#f8f9fa; border-top:1px solid var(--line); }
  .trade-actions button{ 
    flex:1; padding:16px; font-size:1.1rem; border-radius:12px; text-transform:uppercase; 
    font-weight:700; transition:all 0.3s ease; position:relative; overflow:hidden;
  }
  .trade-actions button:before{
    content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition:left 0.5s; z-index:1;
  }
  .trade-actions button:hover:before{ left:100%; }
  .btn-buy{ background:var(--ok); box-shadow:0 4px 14px rgba(40,167,69,0.3); }
  .btn-buy:hover{ background:#218838; box-shadow:0 6px 20px rgba(40,167,69,0.4); transform:translateY(-2px); }
  .btn-sell{ background:var(--err); color:#fff; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .btn-sell:hover{ background:#c82333; box-shadow:0 6px 20px rgba(220,53,69,0.4); transform:translateY(-2px); }
  .loading-spinner{ 
    display:inline-block; width:20px; height:20px; 
    border:3px solid #f3f3f3; border-top:3px solid var(--brand); 
    border-radius:50%; animation:spin 1s linear infinite; 
  }
  @keyframes spin{ 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

  /* Modal Styles */
  .trade-modal{ display:none; position:fixed; inset:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center; }
  .trade-modal.show{ display:flex; }
  .modal-content{ 
    background:var(--card); border:1px solid var(--line); border-radius:var(--rad); 
    box-shadow:0 20px 40px rgba(0,0,0,0.15); padding:20px; max-width:420px; width:90%; 
    max-height:90vh; overflow-y:auto; animation:modalSlideIn 0.3s ease-out;
  }
  @keyframes modalSlideIn{ from{ opacity:0; transform:translateY(-50px); } to{ opacity:1; transform:translateY(0); } }
  .modal-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .modal-title{ font-size:1.5rem; font-weight:700; color:var(--brand); margin:0; }
  .modal-close{ 
    background:none; border:none; font-size:1.5rem; cursor:pointer; color:var(--muted); 
    padding:5px; width:auto; height:auto; box-shadow:none; text-transform:none; 
    border-radius:50%; transition:all 0.3s ease;
  }
  .modal-close:hover{ color:var(--text); background:rgba(0,0,0,0.1); transform:none; box-shadow:none; }
  .panel{ background:#f8f9fa; border:1px solid var(--line); border-radius:12px; padding:20px; margin:0; }
  .titleRow{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .title{ font-size:1.2rem; font-weight:700; color:var(--brand); }
  .avail{ font-size:.9rem; color:var(--muted); }
  .field{ margin-bottom:16px; }
  .inputWrap{ position:relative; display:flex; align-items:center; }
  .inputWrap input{ padding-right:60px; margin:0; border:2px solid var(--line); transition:border-color 0.3s ease; }
  .inputWrap input:focus{ border-color:var(--brand); box-shadow:0 0 0 3px rgba(0,82,204,0.1); }
  .unit{ position:absolute; right:12px; color:var(--muted); font-weight:600; pointer-events:none; }
  .hint{ font-size:.8rem; color:var(--muted); margin-top:4px; text-align:left; }
  .rowBtns{ display:flex; gap:8px; margin-top:8px; }
  .rowBtns button{ 
    flex:1; padding:8px 12px; font-size:.9rem; background:#e9ecef; color:var(--text); 
    border:1px solid var(--line); text-transform:none; font-weight:600; border-radius:6px;
    transition:all 0.3s ease;
  }
  .rowBtns button:hover{ background:var(--brand); color:#fff; transform:translateY(-1px); }
  .totalBox{ margin-bottom:20px; }
  .totalBox input{ background:#e9ecef; color:var(--muted); }
  .cta{ 
    padding:16px; font-size:1.1rem; font-weight:700; text-transform:uppercase; margin:0; 
    border-radius:12px; transition:all 0.3s ease; position:relative; overflow:hidden;
  }
  .cta:before{
    content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition:left 0.5s; z-index:1;
  }
  .cta:hover:before{ left:100%; }
  .cta.buy{ background:var(--ok); box-shadow:0 4px 14px rgba(40,167,69,0.3); }
  .cta.buy:hover{ background:#218838; box-shadow:0 6px 20px rgba(40,167,69,0.4); transform:translateY(-2px); }
  .cta.sell{ background:var(--err); color:#fff; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .cta.sell:hover{ background:#c82333; box-shadow:0 6px 20px rgba(220,53,69,0.4); transform:translateY(-2px); }

  /* My Orders Modal Styles */
  .my-orders-modal{ display:none; position:fixed; inset:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center; }
  .my-orders-modal.show{ display:flex; }
  .my-orders-modal-content{
    background:var(--card); border:1px solid var(--line); border-radius:var(--rad); 
    box-shadow:0 20px 40px rgba(0,0,0,0.15); padding:30px; max-width:500px; width:90%; 
    max-height:90vh; overflow-y:auto;
  }
  .my-orders-modal-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
  }
  .my-orders-modal-title{
    font-size:1.5rem;
    font-weight:700;
    color:var(--brand);
    margin:0;
  }
  .my-orders-modal-close{
    background:none;
    border:none;
    font-size:1.8rem;
    cursor:pointer;
    color:var(--muted);
    padding:0;
    width:auto;
    height:auto;
    box-shadow:none;
    text-transform:none;
  }
  .my-orders-modal-close:hover{
    color:var(--text);
    transform:none;
    box-shadow:none;
  }
  .orders-list {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 20px;
  }
  .order-item {
    display: flex;
    justify-content: space-between;
    padding: 12px;
    border: 1px solid var(--line);
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .order-item:hover {
    background-color: #f8f9fa;
  }
  .order-item.selected {
    border-color: var(--brand);
    background-color: rgba(0, 82, 204, 0.1);
  }
  .order-type {
    font-weight: 700;
    text-transform: uppercase;
    font-size: 12px;
  }
  .order-type.buy {
    color: var(--ok);
  }
  .order-type.sell {
    color: var(--err);
  }
  .order-amount, .order-price {
    font-family: 'SF Mono', monospace;
  }
  .order-actions{
    display:flex;
    flex-direction:column;
    gap:15px;
  }
  .order-action-btn{
    width:100%;
    padding:15px;
    border:none;
    border-radius:12px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
    text-transform:none;
  }
  .edit-order-btn{
    background:var(--brand);
    color:white;
    box-shadow:0 4px 16px rgba(25,118,210,0.3);
  }
  .edit-order-btn:hover{
    background:var(--brand2);
    box-shadow:0 6px 20px rgba(25,118,210,0.4);
    transform:translateY(-2px);
  }
  .cancel-order-btn{
    background:var(--err);
    color:white;
    box-shadow:0 4px 16px rgba(220,53,69,0.3);
  }
  .cancel-order-btn:hover{
    background:#c82333;
    box-shadow:0 6px 20px rgba(220,53,69,0.4);
    transform:translateY(-2px);
  }

  /* Animation */
  .import-card {
    animation: slideUp 0.6s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Send Wizard Styles */
  .send-wizard {
    display: none;
    margin-top: 16px;
    text-align: left;
    border-top: 1px solid var(--line);
    padding-top: 16px;
  }
  .wizard-step {
    display: none;
  }
  .wizard-step.active {
    display: block;
  }
  .wizard-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
  }
  .wizard-progress {
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    margin: 20px 0;
    overflow: hidden;
  }
  .wizard-progress-bar {
    height: 100%;
    background: var(--brand);
    border-radius: 3px;
    transition: width 0.3s ease;
  }
  .balance-info {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 16px;
    font-size: 14px;
  }
  .balance-info strong {
    color: var(--brand);
  }

  @media (max-width: 480px) {
    .app {
      max-width: 100%;
      padding: 0 10px;
    }
    
    .import-card {
      padding: 30px 20px;
      margin: 10px;
    }
    
    .logo-container img {
      width: 60px;
      height: 60px;
    }
    
    h1 {
      font-size: 2.2rem;
    }

    .key-modal-content {
      padding: 30px 20px;
      margin: 10px;
    }

    .key-display-input {
      font-size: 12px;
      padding: 12px 50px 12px 12px;
    }

    .copy-btn {
      padding: 6px 8px;
      font-size: 10px;
    }

    .market-stats {
      grid-template-columns: 1fr;
    }

    .chart-timeframes {
      flex-wrap: wrap;
    }
  }
</style>
</head>
<body>
  <div class="app">
    <div class="logo-container">
      <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="Laam Logo">
      <h1>Laam wallet</h1>
    </div>

    <!-- AUTH SECTION -->
    <div id="authSection">
      <div class="import-card">
        <div id="unlockView" class="hidden">
          <h3 style="margin:0 0 20px 0; color:#1976d2; text-align:center; font-size:1.5rem;">Unlock Wallet</h3>
          <div class="form-group">
            <label class="form-label" for="walletPassword">Password</label>
            <input class="form-input" id="walletPassword" type="password" placeholder="Enter your password" />
          </div>
          <button class="import-button" id="unlockBtn">Unlock</button>
          <div class="divider">
            <span class="divider-text">or</span>
          </div>
          <div class="generate-link">
            <a href="#" id="resetWalletLink" style="color:#1976d2; text-decoration:none;">Reset and Import New Key</a>
          </div>
        </div>

        <div id="initialView">
          <div class="form-group">
            <label class="form-label" for="secretKeyInput">Secret Key (S...)</label>
            <input class="form-input" id="secretKeyInput" type="password" placeholder="SXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"/>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="savePasswordInput">Create Password to Save</label>
            <input class="form-input" id="savePasswordInput" type="password" placeholder="Min 8 chars"/>
          </div>
          
          <button class="import-button" id="importAndSaveBtn">Import wallet and Save</button>
          
          <div class="divider">
            <span class="divider-text">or</span>
          </div>
          
          <div class="generate-link">
            <button class="generate-button" id="generateAccountBtn">Create new wallet</button>
            <p class="note-text">(Remember: You must deposit at least 4 XLM into your wallet for it to be activated.)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Key Display Modal -->
    <div id="keyModal" class="key-modal">
      <div class="key-modal-content">
        <div class="key-modal-header">
          <h3 class="key-modal-title">New Wallet Account Generated</h3>
          <button class="key-modal-close" onclick="closeKeyModal()">&times;</button>
        </div>
        
        <div class="key-display-group">
          <label class="key-display-label">Secret Key (S...)</label>
          <div class="key-display-container">
            <textarea class="key-display-input" id="generatedSecretKey" readonly rows="3"></textarea>
            <button class="copy-btn" onclick="copyToClipboard('generatedSecretKey', this)">Copy</button>
          </div>
        </div>

        <div class="key-display-group">
          <label class="key-display-label">Public Key (G...)</label>
          <div class="key-display-container">
            <textarea class="key-display-input" id="generatedPublicKey" readonly rows="2"></textarea>
            <button class="copy-btn" onclick="copyToClipboard('generatedPublicKey', this)">Copy</button>
          </div>
        </div>

        <div class="warning-text">
          <strong>⚠️IMPORTANT</strong> Save your Secret Key in a secure place! You will need it to access your wallet. If you lose it, you will not be able to recover your account. Also, copy your public key and fund it with at least 4 XLM to activate your wallet.
        </div>

        <button class="use-account-btn" onclick="useGeneratedAccount()">Use This Account</button>
      </div>
    </div>

    <!-- LOGGED IN VIEW -->
    <div id="loggedInView" class="hidden">
      <div class="card">
        <!-- BUTTONS ROW - MATCHING PROVIDED IMAGE -->
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:16px;">
          <!-- Top-left: Send -->
          <button id="btnSendToggle" aria-label="Send" style="background:linear-gradient(180deg,#6fa8ff,#2d9cdb); color:white; border:none; padding:20px; border-radius:18px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; box-shadow:0 6px 18px rgba(45,156,219,0.18);">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
            <div style="font-weight:800; font-size:1.05rem;">Send</div>
          </button>

          <!-- Top-right: Receive -->
          <button id="btnReceive" aria-label="Receive" style="background:linear-gradient(180deg,#3ddc9a,#13a06d); color:white; border:none; padding:20px; border-radius:18px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; box-shadow:0 6px 18px rgba(19,160,109,0.18);">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" viewBox="0 0 24 24"><path d="M12 2v14m0 0l-4-4m4 4l4-4M20 20H4"/></svg>
            <div style="font-weight:800; font-size:1.05rem;">Receive</div>
          </button>

          <!-- Bottom-left: Swap -->
          <button id="btnSwap" aria-label="Swap" style="background:linear-gradient(180deg,#8a7bff,#6a50e6); color:white; border:none; padding:20px; border-radius:18px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; box-shadow:0 6px 18px rgba(106,80,230,0.18);">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H7v2zm10 10H7v-3l-4 4 4 4v-3h10v-2z"/></svg>
            <div style="font-weight:800; font-size:1.05rem;">Swap</div>
          </button>

          <!-- Bottom-right: Add Trustline -->
          <button id="addTrustlineBtn" aria-label="Add Trustline" style="background:linear-gradient(180deg,#6c757d,#4e555b); color:white; border:none; padding:20px; border-radius:18px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; box-shadow:0 6px 18px rgba(78,85,91,0.12);">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" viewBox="0 0 24 24"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm1 5h-2v5H6v2h5v5h2v-5h5v-2h-5V7z"/></svg>
            <div style="font-weight:800; font-size:1.05rem;">Add Trustline</div>
          </button>
        </div>

        <!-- Total assets card (prominent) matching layout in the image -->
        <div style="margin: 18px 0 8px 0; padding: 14px; background: linear-gradient(90deg,#1e88e5,#0d47a1); border-radius: 16px; color: white; text-align: center; box-shadow: 0 8px 24px rgba(13,71,161,0.18);">
          <div style="font-size: 0.95rem; margin-bottom: 6px; opacity: 0.95;">Total assets</div>
          <div style="font-size: 2.2rem; font-weight: 900;">$<span id="totalAssets">0</span></div>
        </div>

        <!-- Tokens list styled like the provided image -->
        <div style="background:linear-gradient(180deg,#ffffff,rgba(255,255,255,0.92)); padding:12px; border-radius:14px; border:1px solid rgba(0,0,0,0.04); box-shadow:0 8px 30px rgba(0,0,0,0.04); margin-top:8px;">
          <div style="display:flex; flex-direction:column; gap:12px; align-items:stretch;">
            <!-- Token row: XLM -->
            <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 10px; border-radius:12px; background:transparent;">
              <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#dbeafe,#bfdbfe); box-shadow:0 6px 14px rgba(2,6,23,0.06);">
                  <img src="https://res.coinpaper.com/coinpaper/stellar_xlm_logo_07021d63c0.png" alt="XLM" style="width:28px;height:28px;">
                </div>
                <div style="text-align:left;">
                  <div style="font-weight:800;">XLM</div>
                  <div style="font-size:0.85rem; color:#6b7280;">$<span id="xlmPriceSmall">0.409</span> / XLM</div>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-weight:900; font-size:1.05rem;" id="xlmBal">0</div>
                <div style="font-size:0.85rem; color:#6b7280;">$<span id="xlmUsd">0</span></div>
              </div>
            </div>

            <!-- Token row: LAAM -->
            <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 10px; border-radius:12px; background:transparent;">
              <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#e9d5ff,#d6bbff); box-shadow:0 6px 14px rgba(2,6,23,0.06);">
                  <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="Laam" style="width:28px;height:28px;">
                </div>
                <div style="text-align:left;">
                  <div style="font-weight:800;">LAAM</div>
                  <div style="font-size:0.85rem; color:#6b7280;">$<span id="laamPriceSmall">0.056</span> / Laam</div>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-weight:900; font-size:1.05rem;" id="laamBal">0</div>
                <div style="font-size:0.85rem; color:#6b7280;">$<span id="laamUsd">0</span></div>
              </div>
            </div>

            <!-- Token row: USDC -->
            <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 10px; border-radius:12px; background:transparent;">
              <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#d1fae5,#a7f3d0); box-shadow:0 6px 14px rgba(2,6,23,0.06);">
                  <img src="https://cryptologos.cc/logos/usd-coin-usdc-logo.png?v=024" alt="USDC" style="width:28px;height:28px;border-radius:6px;">
                </div>
                <div style="text-align:left;">
                  <div style="font-weight:800;">USDC</div>
                  <div style="font-size:0.85rem; color:#6b7280;">$1.00 / USDC</div>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-weight:900; font-size:1.05rem;" id="usdcBal">0</div>
                <div style="font-size:0.85rem; color:#6b7280;">$<span id="usdcUsd">0</span></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Send Wizard -->
        <div id="sendWizard" class="send-wizard">
          <div class="wizard-progress">
            <div class="wizard-progress-bar" id="wizardProgress" style="width: 33%"></div>
          </div>
          
          <!-- Step 1: Select Asset and Amount -->
          <div class="wizard-step active" id="step1">
            <h4 style="margin:0 0 10px 0; color:var(--brand)">Send Assets</h4>
            
            <div class="balance-info">
              Available: <strong id="availableBalance">0 XLM</strong>
            </div>
            
            <div class="send-row">
              <div>
                <label for="sendAsset">Asset</label>
                <select id="sendAsset">
                  <option value="XLM">XLM</option>
                  <option value="LAAM">Laam</option>
                  <option value="USDC">USDC</option>
                </select>
              </div>
              <div>
                <label for="sendAmount">Amount</label>
                <input id="sendAmount" type="number" step="0.0000001" placeholder="e.g. 10" />
              </div>
            </div>
            
            <div class="wizard-nav">
              <button class="btn-secondary" onclick="closeSendWizard()">Cancel</button>
              <button class="btn-primary" onclick="nextStep(2)">Next</button>
            </div>
          </div>
          
          <!-- Step 2: Enter Destination and Memo -->
          <div class="wizard-step" id="step2">
            <h4 style="margin:0 0 10px 0; color:var(--brand)">Recipient Details</h4>
            
            <label for="sendDest">Destination Public Key</label>
            <input id="sendDest" type="text" placeholder="G... destination" />
            
            <div class="form-group">
              <label for="sendMemo">Memo (Optional)</label>
              <input class="form-input" id="sendMemo" type="text" placeholder="Memo text or ID" />
            </div>
            
            <div class="wizard-nav">
              <button class="btn-secondary" onclick="prevStep(1)">Back</button>
              <button class="btn-primary" onclick="nextStep(3)">Next</button>
            </div>
          </div>
          
          <!-- Step 3: Confirm Transaction -->
          <div class="wizard-step" id="step3">
            <h4 style="margin:0 0 10px 0; color:var(--brand)">Confirm Transaction</h4>
            
            <div class="balance-info">
              <div><strong>Asset:</strong> <span id="confirmAsset">XLM</span></div>
              <div><strong>Amount:</strong> <span id="confirmAmount">0</span></div>
              <div><strong>To:</strong> <span id="confirmDest" class="mono" style="display:block; margin-top:5px; font-size:12px;">G... destination</span></div>
              <div id="confirmMemoContainer" style="display:none;">
                <strong>Memo:</strong> <span id="confirmMemo"></span>
              </div>
            </div>
            
            <div class="wizard-nav">
              <button class="btn-secondary" onclick="prevStep(2)">Back</button>
              <button id="btnSend" class="btn-primary">Confirm Send</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Trade Section -->
      <div class="card trade-card">
        <!-- Trade section content remains the same as in the original -->
        <!-- ... -->
      </div>
    </div>
  </div>

  <!-- Trade Modal -->
  <div id="tradeModal" class="trade-modal">
    <!-- Trade modal content remains the same as in the original -->
    <!-- ... -->
  </div>

  <!-- My Orders Modal -->
  <div id="myOrdersModal" class="my-orders-modal">
    <!-- My orders modal content remains the same as in the original -->
    <!-- ... -->
  </div>

  <!-- Edit Order Modal -->
  <div id="editOrderModal" class="trade-modal">
    <!-- Edit order modal content remains the same as in the original -->
    <!-- ... -->
  </div>
  
  <div id="successAlert" class="custom-alert">Transaction sent successful</div>

  <script>
    // Laam token configuration
    const LAAM_TOKEN = {
      code: "Laam",
      issuer: "GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64",
      name: "Laam",
      description: "Laam is a limited supply token on Stellar with a maximum of 1,335,577 tokens, issued only once to preserve value.",
      image: "https://i.ibb.co/r28SP1bN/20250802-225108.png",
      maxSupply: 1335577,
      currentPrice: 0.06
    };

    // Global variables
    let currentKeypair = null;
    let server = null;
    
    const USDC_TOKEN = {
      code: "USDC",
      issuer: "GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN"
    };
    let USDC_ASSET = new StellarSdk.Asset(USDC_TOKEN.code, USDC_TOKEN.issuer);
    let LAAM_ASSET = null;
    let xlmPriceUSD = 0.42;
    let currentTradeMode = 'buy';
    let generatedKeypair = null;
    let currentTab = 'orderbook';
    let orderbookData = { bids: [], asks: [] };
    let tradesData = [];
    let currentOfferId = null;
    let priceChart = null; // Chart.js instance
    
    // Initialize Stellar SDK
    function initializeStellar() {
      try {
        if (typeof StellarSdk !== 'undefined') {
          server = new StellarSdk.Server('https://horizon.stellar.org');
          console.log('Stellar SDK initialized successfully');
        } else {
          console.error('Stellar SDK not loaded');
          showError('Stellar SDK failed to load. Please refresh the page.');
        }
      } catch (error) {
        console.error('Error initializing Stellar SDK:', error);
        showError('Failed to initialize Stellar SDK: ' + error.message);
      }
    }
    
    function initializeAssets() {
      try {
        if (typeof StellarSdk !== 'undefined') {
          LAAM_ASSET = new StellarSdk.Asset(LAAM_TOKEN.code, LAAM_TOKEN.issuer);
          console.log('Assets initialized successfully');
        }
      } catch (error) {
        console.error('Error initializing assets:', error);
      }
    }
    
    // Utility functions
    function showError(message) {
      alert('Error: ' + message);
    }
    
    function showSuccess(message) {
      const alertBox = document.getElementById("successAlert");
      alertBox.textContent = message;
      alertBox.style.display = "block";
      setTimeout(() => {
        alertBox.style.display = "none";
      }, 3000);
    }
    
    function formatAmount(amount) {
      return parseFloat(amount).toFixed(7);
    }
    
    function encryptSecretKey(secretKey, password) {
      return CryptoJS.AES.encrypt(secretKey, password).toString();
    }
    
    function decryptSecretKey(encryptedKey, password) {
      try {
        const bytes = CryptoJS.AES.decrypt(encryptedKey, password);
        return bytes.toString(CryptoJS.enc.Utf8);
      } catch (e) {
        return null;
      }
    }

    // Copy to clipboard function
    async function copyToClipboard(elementId, buttonElement) {
      try {
        const element = document.getElementById(elementId);
        const text = element.value;
        
        await navigator.clipboard.writeText(text);
        
        const originalText = buttonElement.textContent;
        buttonElement.textContent = 'Copied!';
        buttonElement.classList.add('copied');
        
        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.classList.remove('copied');
        }, 2000);
        
      } catch (err) {
        console.error('Failed to copy:', err);
        const element = document.getElementById(elementId);
        element.select();
        element.setSelectionRange(0, 99999);
        document.execCommand('copy');
        
        const originalText = buttonElement.textContent;
        buttonElement.textContent = 'Copied!';
        buttonElement.classList.add('copied');
        
        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.classList.remove('copied');
        }, 2000);
      }
    }

    // Key modal functions
    function openKeyModal(secretKey, publicKey) {
      document.getElementById('generatedSecretKey').value = secretKey;
      document.getElementById('generatedPublicKey').value = publicKey;
      document.getElementById('keyModal').classList.add('show');
    }

    function closeKeyModal() {
      document.getElementById('keyModal').classList.remove('show');
      generatedKeypair = null;
    }

    function useGeneratedAccount() {
      if (generatedKeypair) {
        document.getElementById('secretKeyInput').value = generatedKeypair.secret();
        closeKeyModal();
        showSuccess('Account keys have been filled in the form. Please create a password to save your wallet.');
      }
    }

    // Send Wizard Functions
    function openSendWizard() {
      document.getElementById('sendWizard').style.display = 'block';
      updateAvailableBalance();
    }

    function closeSendWizard() {
      document.getElementById('sendWizard').style.display = 'none';
      resetWizard();
    }

    function resetWizard() {
      // Reset all wizard steps
      document.querySelectorAll('.wizard-step').forEach(step => {
        step.classList.remove('active');
      });
      document.getElementById('step1').classList.add('active');
      document.getElementById('wizardProgress').style.width = '33%';
      
      // Clear form fields
      document.getElementById('sendAmount').value = '';
      document.getElementById('sendDest').value = '';
      document.getElementById('sendMemo').value = '';
    }

    function nextStep(step) {
      // Validate current step before proceeding
      if (step === 2) {
        const amount = parseFloat(document.getElementById('sendAmount').value);
        if (!amount || amount <= 0) {
          showError('Please enter a valid amount');
          return;
        }
        
        const asset = document.getElementById('sendAsset').value;
        const balance = getCurrentBalance(asset);
        if (amount > balance) {
          showError(`Insufficient ${asset} balance`);
          return;
        }
      } else if (step === 3) {
        const dest = document.getElementById('sendDest').value;
        if (!dest || !dest.startsWith('G')) {
          showError('Please enter a valid destination public key');
          return;
        }
        
        // Update confirmation details
        document.getElementById('confirmAsset').textContent = document.getElementById('sendAsset').value;
        document.getElementById('confirmAmount').textContent = document.getElementById('sendAmount').value;
        document.getElementById('confirmDest').textContent = dest;
        
        const memo = document.getElementById('sendMemo').value;
        if (memo) {
          document.getElementById('confirmMemo').textContent = memo;
          document.getElementById('confirmMemoContainer').style.display = 'block';
        } else {
          document.getElementById('confirmMemoContainer').style.display = 'none';
        }
      }
      
      // Hide current step
      document.querySelector('.wizard-step.active').classList.remove('active');
      // Show next step
      document.getElementById('step' + step).classList.add('active');
      // Update progress bar
      document.getElementById('wizardProgress').style.width = (step * 33) + '%';
    }

    function prevStep(step) {
      // Hide current step
      document.querySelector('.wizard-step.active').classList.remove('active');
      // Show previous step
      document.getElementById('step' + step).classList.add('active');
      // Update progress bar
      document.getElementById('wizardProgress').style.width = (step * 33) + '%';
    }

    function updateAvailableBalance() {
      const asset = document.getElementById('sendAsset').value;
      const balance = getCurrentBalance(asset);
      document.getElementById('availableBalance').textContent = `${balance} ${asset}`;
    }

    function getCurrentBalance(asset) {
      switch(asset) {
        case 'XLM': return parseFloat(document.getElementById('xlmBal').textContent) || 0;
        case 'LAAM': return parseFloat(document.getElementById('laamBal').textContent) || 0;
        case 'USDC': return parseFloat(document.getElementById('usdcBal').textContent) || 0;
        default: return 0;
      }
    }

    // Tab switching functionality
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      document.getElementById(tabName + 'Tab').classList.add('active');
      document.getElementById(tabName + 'Content').classList.add('active');
      
      currentTab = tabName;
      
      if (tabName === 'orderbook') {
        fetchOrderbook();
      } else if (tabName === 'lastTrades') {
        fetchTrades();
      } else if (tabName === 'overview') {
        updateOverview();
      }
    }

    // Fetch XLM price from API
    async function fetchXLMPrice() {
      try {
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=stellar&vs_currencies=usd');
        const data = await response.json();
        if (data.stellar && data.stellar.usd) {
          xlmPriceUSD = data.stellar.usd;
          console.log('XLM price updated:', xlmPriceUSD);
          // Update XLM price display
          document.getElementById('xlmPriceSmall').textContent = xlmPriceUSD.toFixed(3);
        }
      } catch (error) {
        console.error('Error fetching XLM price:', error);
        xlmPriceUSD = 0.12;
      }
    }

    // Update balance display function
    async function updateBalanceDisplay() {
      if (!currentKeypair || !server) {
        console.log('No keypair or server available');
        return;
      }

      try {
        console.log('Loading account data...');
        const account = await server.loadAccount(currentKeypair.publicKey());
        
        let xlmBalance = 0;
        let laamBalance = 0;
        let usdcBalance = 0;

        account.balances.forEach(balance => {
          if (balance.asset_type === 'native') {
            xlmBalance = parseFloat(balance.balance);
          } else if (
            balance.asset_code === LAAM_TOKEN.code &&
            balance.asset_issuer === LAAM_TOKEN.issuer
          ) {
            laamBalance = parseFloat(balance.balance);
          } else if (
            balance.asset_code === USDC_TOKEN.code &&
            balance.asset_issuer === USDC_TOKEN.issuer
          ) {
            usdcBalance = parseFloat(balance.balance);
          }
        });

        // ✅ XLM part
        document.getElementById('xlmBal').textContent = xlmBalance.toFixed(2);
        document.getElementById('xlmUsd').textContent = (xlmBalance * xlmPriceUSD).toFixed(2);

        // ✅ Laam part - Calculate USD value based on current price
        document.getElementById('laamBal').textContent = laamBalance.toFixed(2);
        document.getElementById('laamUsd').textContent = (laamBalance * LAAM_TOKEN.currentPrice).toFixed(2);
        
        // ✅ USDC part (USDC is a stablecoin pegged to 1 USD)
        document.getElementById('usdcBal').textContent = usdcBalance.toFixed(2);
        document.getElementById('usdcUsd').textContent = usdcBalance.toFixed(2);
        
        updateTotalAssets();
        
        console.log('Balance display updated successfully');
        
      } catch (error) {
        console.error('Error updating balance display:', error);
        showError('Failed to load account balance: ' + error.message);
      }
    }

    // Update total assets value
    function updateTotalAssets() {
      const xlmUsd = parseFloat(document.getElementById('xlmUsd').textContent) || 0;
      const laamUsd = parseFloat(document.getElementById('laamUsd').textContent) || 0;
      const usdcUsd = parseFloat(document.getElementById('usdcUsd').textContent) || 0;
      const totalAssets = (xlmUsd + laamUsd + usdcUsd).toFixed(2);
      document.getElementById('totalAssets').textContent = totalAssets;
    }

    // Load wallet function
    async function loadWallet() {
      if (!currentKeypair) {
        console.error('No keypair available');
        return;
      }

      try {
        console.log('Loading wallet for:', currentKeypair.publicKey());
        
        await fetchXLMPrice();
        await updateBalanceDisplay();
        
        if (currentTab === 'orderbook') {
          await fetchOrderbook();
        } else if (currentTab === 'lastTrades') {
          await fetchTrades();
        } else if (currentTab === 'overview') {
          updateOverview();
        }
        
        console.log('Wallet loaded successfully');
        
      } catch (error) {
        console.error('Error loading wallet:', error);
        
        // Only show error if wallet view is visible
        if (!document.getElementById('loggedInView').classList.contains('hidden')) {
          showError('Failed to load wallet: ' + error.message);
        }
      }
    }

    // Check if wallet exists in localStorage
    function checkSavedWallet() {
      const encryptedKey = localStorage.getItem('laam_wallet_key');
      if (encryptedKey) {
        document.getElementById('initialView').classList.add('hidden');
        document.getElementById('unlockView').classList.remove('hidden');
      }
    }

    // Send transaction function
    async function sendTransaction() {
      const asset = document.getElementById('sendAsset').value;
      const amount = document.getElementById('sendAmount').value;
      const destination = document.getElementById('sendDest').value;
      const memo = document.getElementById('sendMemo').value;
      
      if (!amount || !destination) {
        showError('Please fill in all fields.');
        return;
      }
      
      if (!currentKeypair) {
        showError('Wallet not loaded.');
        return;
      }
      
      const sendBtn = document.getElementById('btnSend');
      sendBtn.textContent = 'Sending...';
      sendBtn.disabled = true;
      
      try {
        const account = await server.loadAccount(currentKeypair.publicKey());
        
        let operation;
        if (asset === 'XLM') {
          operation = StellarSdk.Operation.payment({
            destination: destination,
            asset: StellarSdk.Asset.native(),
            amount: amount
          });
        } else if (asset === 'LAAM') {
          operation = StellarSdk.Operation.payment({
            destination: destination,
            asset: LAAM_ASSET,
            amount: amount
          });
        } else if (asset === 'USDC') {
          operation = StellarSdk.Operation.payment({
            destination: destination,
            asset: USDC_ASSET,
            amount: amount
          });
        }
        
        const transactionBuilder = new StellarSdk.TransactionBuilder(account, {
          fee: StellarSdk.BASE_FEE,
          networkPassphrase: StellarSdk.Networks.PUBLIC
        });

        if (memo) {
          transactionBuilder.addMemo(StellarSdk.Memo.text(memo));
        }

        const transaction = transactionBuilder
          .addOperation(operation)
          .setTimeout(180)
          .build();
        
        transaction.sign(currentKeypair);
        
        const result = await server.submitTransaction(transaction);
        
        showSuccess('Transaction sent successfully!');
        closeSendWizard();
        
        await updateBalanceDisplay();
        
      } catch (error) {
        console.error('Send transaction error:', error);
        showError('Failed to send transaction: ' + error.message);
      } finally {
        sendBtn.textContent = 'Confirm Send';
        sendBtn.disabled = false;
      }
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing...');
      
      initializeStellar();
      initializeAssets();
      
      if (typeof StellarSdk === 'undefined') {
        console.error('StellarSdk is not defined');
        showError('Stellar SDK failed to load. Please refresh the page.');
        return;
      }
      
      if (typeof CryptoJS === 'undefined') {
        console.error('CryptoJS is not defined');
        showError('CryptoJS failed to load. Please refresh the page.');
        return;
      }
      
      console.log('All libraries loaded successfully');
      
      checkSavedWallet();
      
      // Event listeners for send wizard
      document.getElementById('sendAsset').addEventListener('change', updateAvailableBalance);
      document.getElementById('btnSend').addEventListener('click', sendTransaction);
      document.getElementById('btnSendToggle').addEventListener('click', openSendWizard);
      
      // Other event listeners remain the same as in the original code
      // ...
      
      console.log('All event listeners attached successfully');
    });

    // Auto-refresh balance, price, and current tab data every 30 seconds
    setInterval(async () => {
      if (currentKeypair && !document.getElementById('loggedInView').classList.contains('hidden')) {
        await fetchXLMPrice();
        await updateBalanceDisplay();
        
        if (currentTab === 'orderbook') {
          await fetchOrderbook();
        } else if (currentTab === 'lastTrades') {
          await fetchTrades();
        } else if (currentTab === 'overview') {
          updateOverview();
        }
      }
    }, 30000);
  </script>
</body>
</html>
